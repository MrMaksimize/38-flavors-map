---
layout: page
title: Israel
attributes: [maps]
---
<style>
    .cluster-div-icon, .photo-div-icon {
        background:transparent !important;
        border:0px !important;
    }
</style>
<script type='text/javascript'>

    $(document).ready(function() {
       taglitMapper.map = new L.Map('map-div');
       wax.tilejson(taglitMapper.mapboxUrl, function(tilejson) {
            var leafConnector = new wax.leaf.connector(tilejson);
            taglitMapper.map.addLayer(leafConnector);
            taglitMapper.map.setView(new L.LatLng(taglitMapper.center.lat, taglitMapper.center.lng), taglitMapper.center.zoom);
        });

        // Set Up Clusters For Each Location:
        var clusters = {};
        for (var i in positions) {
            var uniqueId = taglitMapper.getRandom(0, 999999999999999, true);
            var createdCluster = new L.MarkerClusterGroup({
                disableClusteringAtZoom: 17, 
                showCoverageOnHover: false,
                iconCreateFunction: function(cluster) {
                    // @todo - grow the image on cluster hover.
                    var allMarkers = cluster.getAllChildMarkers();
                    var randomMarkerPos = taglitMapper.getRandom(0, allMarkers.length - 1, true);
                    var clusterIconHtml = '<img class="cluster-' + cluster._leaflet_id + ' img-circle" src="' + allMarkers[randomMarkerPos].photoUrlSq +'" width="' + taglitMapper.clusterIconSize + 'px"></img>';
                    return new L.DivIcon({
                        html: clusterIconHtml,
                        className: 'cluster-div-icon',
                        iconSize: taglitMapper.clusterIconSize
                    });
                }
            });
            createdCluster.on('clustermouseover', function(a) {
                console.log(a);
                var id = 'cluster-' + a.layer._leaflet_id;
                $('.' + id).animate({
                    width: taglitMapper.clusterIconSizeLarge + "px",
                    opacity: taglitMapper.clusterIconOpacityOn,
                });
            });
            createdCluster.on('clustermouseout', function(a) {
                console.log(a);
                var id = 'cluster-' + a.layer._leaflet_id;
                $('.' + id).animate({
                    width: taglitMapper.clusterIconSize + "px",
                    opacity: taglitMapper.clusterIconOpacityOff,
                });
            });
            createdCluster.on('mouseover', function(a) {
                console.log(a);
                var id = 'photo-' + a.layer.photo_id;
                $('.' + id).animate({
                    width: taglitMapper.markerIconSizeLarge + "px",
                    opacity: taglitMapper.markerIconOpacityOn,
                });
            });
            createdCluster.on('mouseout', function(a) {
                console.log(a);
                var id = 'photo-' + a.layer.photo_id;
                $('.' + id).animate({
                    width: taglitMapper.markerIconSize + "px",
                    opacity: taglitMapper.markerIconOpacityOff,
                });
            });
            clusters[positions[i].machineName] = createdCluster;
        }

        console.log(taglitMapper);
        var flickURL = taglitMapper.getFlickURL(1);
       $.ajax({
            url: flickURL,
            type: 'GET',
            dataType: 'jsonp',
            error: function(xhr, status, error) {
                console.log(error);
            },
            success: function(flickResult) {
                console.log(flickResult);
                var photos = {};
                for ( var i = 0; i < flickResult.photoset.photo.length; i++ ) {
                    var photo = flickResult.photoset.photo[i];
                    photo.dateTaken = new Date(photo.datetaken);
                    if (photo.longitude == 0 && photo.latitude == 0) {
                        // Get position based on photo date.
                        photo.photoMeta = taglitMapper.getMetaByDate(photo.dateTaken);
                        if (photo.photoMeta) {
                            photo.latitude = photo.photoMeta.photoPos.lat;
                            photo.longitude = photo.photoMeta.photoPos.lng;
                        }
                        
                    }
                    if (photo.latitude != 0 && photo.longitude != 0) {
                        var marker = new L.marker([photo.latitude, photo.longitude]);
                        photo.photoURL = 'http://www.flickr.com/photos/' + photo.pathalias + '/' + photo.id;
                        var popupHtml = "<div style='text-align:center'><a id='map-image' class='map-image' href='" + photo.url_o + "' data-date-taken='" + photo.datetaken + "' data-near='" + photo.photoMeta.name + "' onClick='taglitMapper.openModal(this); return false;'><img src='" + photo.url_t + "' style='width:150px'></img></a><br/><a href='" + photo.photoURL + "'>" + photo.datetaken + "</a></div>";
                        var photoIconHtml = '<img class="photo-' + photo.id + ' img-circle" src="' + photo.url_sq +'" width="' + taglitMapper.markerIconSize + 'px"></img>';
                        var photoIcon = L.divIcon({
                            className: 'photo-div-icon',
                            html: photoIconHtml,
                            iconSize: taglitMapper.markerIconSize,
                        });
                        marker.photo_id = photo.id;
                        marker.setIcon(photoIcon);
                        marker.bindPopup(popupHtml);
                        marker.photoUrlSq = photo.url_sq;
                        if (!photos[photo.photoMeta.machineName]) {
                            photos[photo.photoMeta.machineName] = [];
                        }
                        photos[photo.photoMeta.machineName].push(marker);
                    }
                }
                for (var i in clusters) {
                    var cluster = clusters[i];
                    var clusterPhotos = photos[i];
                    cluster.addLayers(clusterPhotos);
                    taglitMapper.map.addLayer(cluster);
                }
            }
        });
    });


</script>


<div id="map-div" style="width:100%; height:700px"></div>

<!-- Modal -->
<div id="image-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="modal-label">Modal header</h3>
  </div>
  <div class="modal-body">
    <p>One fine body…</p>
  </div>
  <div class="modal-footer">
  </div>
</div>


