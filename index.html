---
layout: page
title: Israel
attributes: [maps]
---
<style>
    .leaflet-div-icon {
        background:transparent !important;
        border:0px !important;
    }
</style>
<script type='text/javascript'>

    $(document).ready(function() {
       taglitMapper.map = new L.Map('map-div');
       wax.tilejson(taglitMapper.mapboxUrl, function(tilejson) {
            var leafConnector = new wax.leaf.connector(tilejson);
            taglitMapper.map.addLayer(leafConnector);
            taglitMapper.map.setView(new L.LatLng(taglitMapper.center.lat, taglitMapper.center.lng), taglitMapper.center.zoom);
        });

        // Set Up Clusters For Each Location:
        var clusters = {};
        for (var i in positions) {
            var createdCluster = new L.MarkerClusterGroup({
                disableClusteringAtZoom: 17, 
                showCoverageOnHover: false,
                iconCreateFunction: function(cluster) {
                    // @todo - grow the image on cluster hover.
                    var allMarkers = cluster.getAllChildMarkers();
                    var randomMarkerPos = taglitMapper.getRandom(0, allMarkers.length - 1, true);
                    var clusterHtml = '<img src="' + allMarkers[randomMarkerPos].photoUrlSq +'" width="75px" class="img-circle"></img>';
                    return new L.DivIcon({ html: clusterHtml });
                }
            });

            createdCluster.on('clustermouseover', function(a) {
                //console.log(a);
            });
            clusters[positions[i].machineName] = createdCluster;
        }
       /*markerCluster.on('clusterclick', function (a) {
            a.layer.zoomToBounds();
       });*/
       /*markerCluster.on('click', function (a) {
        console.log('marker ' + a.layer);
        var marker = a.layer;
        console.log(marker);
       });*/
        console.log(taglitMapper);
        var flickURL = taglitMapper.getFlickURL(1);
       $.ajax({
            url: flickURL,
            type: 'GET',
            dataType: 'jsonp',
            error: function(xhr, status, error) {
                console.log(error);
            },
            success: function(flickResult) {
                console.log(flickResult);
                var photos = {};
                for ( var i = 0; i < flickResult.photoset.photo.length; i++ ) {
                    var photo = flickResult.photoset.photo[i];
                    photo.dateTaken = new Date(photo.datetaken);
                    if (photo.longitude == 0 && photo.latitude == 0) {
                        // Get position based on photo date.
                        photo.photoMeta = taglitMapper.getMetaByDate(photo.dateTaken);
                        if (photo.photoMeta) {
                            photo.latitude = photo.photoMeta.photoPos.lat;
                            photo.longitude = photo.photoMeta.photoPos.lng;
                        }
                        
                    }
                    if (photo.latitude != 0 && photo.longitude != 0) {
                        photo.photoURL = 'http://www.flickr.com/photos/' + photo.pathalias + '/' + photo.id;
                        var popupHtml = "<div style='text-align:center'><a id='map-image' class='map-image' href='" + photo.url_o + "'><img src='" + photo.url_t + "' style='width:150px'></img></a><br/><a href='" + photo.photoURL + "'>" + photo.datetaken + "</a></div>";
                        
                        var marker = new L.marker([photo.latitude, photo.longitude]).bindPopup(popupHtml);
                        marker.photoUrlSq = photo.url_sq;
                        if (!photos[photo.photoMeta.machineName]) {
                            photos[photo.photoMeta.machineName] = [];
                        }
                        photos[photo.photoMeta.machineName].push(marker);
                    }
                }
                for (var i in clusters) {
                    var cluster = clusters[i];
                    var clusterPhotos = photos[i];
                    cluster.addLayers(clusterPhotos);
                    taglitMapper.map.addLayer(cluster);
                }
            }
        });
    });


</script>


<div id="map-div" style="width:100%; height:700px"></div>




